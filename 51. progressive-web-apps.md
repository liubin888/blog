
#### 什么是渐进式 Web 应用

渐进式 Web 应用首先是一种应用，它根据设备的支持情况来提供更多功能，提供离线能力，推送通知，甚至原生应用的外观和速度，以及对资源进行本地缓存。

渐进式 Web 应用是一个网站，它使用了某些开发技术，使其体验比普通针对移动优化的网站体验更好。它使用起来就像是在使用一个原生应用一样 

渐进式 Web 应用可能是一个不清晰的术语，而更好的定义是：它们是一种 Web 应用，利用现代浏览器特性（比如 Web Worker 和 Web 应用清单），让移动设备对其“升级”，使之成为一等公民角色的应用程序。

 
#### 解决方案 渐进式Web App（PWA）
PWA结合了最好的Web应用和最好的原生应用的用户体验。包含以下:

* 渐进式 - 每个用户都可用而不管选择什么样的浏览器，因为它们是以渐进式增强为核心原则构建的。 
* 自适应 - 适应任何形态：桌面，移动设备，平板电脑或尚未出现的形式。 
* 不依赖网络连接 - Service Workers允许离线工作，或在低质量网络上工作。 
* 类似于应用程序 - 使用应用程序风格的交互和导航，感觉像一个应用程序。 
* 保持最新 - 得益于service Woker的更新进程，应用能始终保持最新状态。 
* 安全 - 借助于HTTPS，防止窥探，并确保内容没有被篡改 
* 可发现 - 受益于W3C清单和service Worker注册作用域，搜索引擎可找到它们，可以识别为“应用程序”。 
* 用户粘性 - 通过推送通知等功能让用户重返应用。 
* 可安装 - 允许用户在主屏幕上“保留”他们认为最有用的应用程序，而无需经过应用程序商店。 
* 可链接 - 通过URL轻松共享，不需要复杂的安装。

#### 离线解决方案 Service Workers
渐进式 Web 应用的定义中有部分是这样说的：它必须支持离线工作。

由于允许 Web 应用程序脱机工作的是 Service Worker，这意味着 Service Worker 是渐进式 Web 应用强制要求的部分。

##### 1.使用HTTPS
渐进式Web应用程序需要使用HTTPS连接。虽然使用HTTPS会让您服务器的开销变多，但使用HTTPS可以让您的网站变得更安全 ,[如何给网站开启https]()

##### 2.创建一个应用程序清单（Manifest）
应用程序清单提供了和当前渐进式Web应用的相关信息，如：
- 应用程序名
- 描述
- 所有图片（包括主屏幕图标，启动屏幕页面和用的图片或者网页上用的图片）

本质上讲，程序清单是页面上用到的图标和主题等资源的元数据。

程序清单是一个位于您应用根目录的JSON文件。该JSON文件返回时必须添加Content-Type: application/manifest+json 或者 Content-Type: application/jsonHTTP头信息。程序清单的文件名不限，在本文的示例代码中为manifest.json： 
```json
{
  "name"              : "PWA Website",
  "short_name"        : "PWA",
  "description"       : "An example PWA website",
  "start_url"         : "/",
  "display"           : "standalone",
  "orientation"       : "any",
  "background_color"  : "#ACE",
  "theme_color"       : "#ACE",
  "icons": [
    {
      "src"           : "/images/logo/logo072.png",
      "sizes"         : "72x72",
      "type"          : "image/png"
    },
    {
      "src"           : "/images/logo/logo152.png",
      "sizes"         : "152x152",
      "type"          : "image/png"
    },
    {
      "src"           : "/images/logo/logo192.png",
      "sizes"         : "192x192",
      "type"          : "image/png"
    },
    {
      "src"           : "/images/logo/logo256.png",
      "sizes"         : "256x256",
      "type"          : "image/png"
    },
    {
      "src"           : "/images/logo/logo512.png",
      "sizes"         : "512x512",
      "type"          : "image/png"
    }
  ]
}
```
程序清单文件建立完之后，你需要在每个页面上引用该文件：
```html
<link rel="manifest"href="/manifest.json">
```

以下属性在程序清单中经常使用，介绍说明如下：

- name: 用户看到的应用名称
- short_name:应用短名称。当显示应用名称的地方不够时，将使用该名称。
- description: 应用描述。
- start_url: 应用起始路径，相对路径，默认为/。
- scope: URL范围。比如：如果您将“/app/”设置为URL范围时，这个应用就会一直在这个目录中。
- background_color:欢迎页面的背景颜色和浏览器的背景颜色（可选）
- theme_color: 应用的主题颜色，一般都会和背景颜色一样。这个设置决定了应用如何显示。
- orientation: 优先旋转方向，可选的值有：any, natural,landscape, landscape-primary, landscape-secondary, portrait, portrait-primary,and portrait-secondary
- display: 显示方式——fullscreen（无Chrome），standalone（和原生应用一样），minimal-ui（最小的一套UI控件集）或者browser（最古老的使用浏览器标签显示）
- icons:一个包含所有图片的数组。该数组中每个元素包含了图片的URL，大小和类型。 

#### 3.创建一个 Service Worker

Service Worker 是一个可编程的服务器代理，它可以拦截或者响应网络请求。ServiceWorker 是位于应用程序根目录的一个个的JavaScript文件。
您需要在页面对应的JavaScript文件中注册该ServiceWorker：
```js
//main.js
if ('serviceWorker' in navigator) {
  // register service worker
  navigator.serviceWorker.register('/service-worker.js');
}

```

如果您不需要离线的相关功能，您可以只创建一个 /service-worker.js文件，这样用户就可以直接安装您的Web应用了！

Service Worker这个概念可能比较难懂，它其实是一个工作在其他线程中的标准的Worker，它不可以访问页面上的DOM元素，没有页面上的API，但是可以拦截所有页面上的网络请求，包括页面导航，请求资源，Ajax请求。

上面就是使用全站HTTPS的主要原因了。假设您没有在您的网站中使用HTTPS，一个第三方的脚本就可以从其他的域名注入他自己的ServiceWorker，然后篡改所有的请求——这无疑是非常危险的。

Service Worker 会响应三个事件：install，activate和fetch。 

>Service Worker 和 Web Worker 不是同一个东西 ,不要搞混淆了

##### Install事件
该事件将在应用安装完成后触发。我们一般在这里使用CacheAPI缓存一些必要的文件。

首先，我们需要提供如下配置

- 缓存名称（CACHE）以及版本（version）。应用可以有多个缓存存储，但是在使用时只会使用其中一个缓存存储。每当缓存存储有变化时，新的版本号将会指定到缓存存储中。新的缓存存储将会作为当前的缓存存储，之前的缓存存储将会被作废。
- 一个离线的页面地址（offlineURL）：当用户访问了之前没有访问过的地址时，该页面将会显示。
- 一个包含了所有必须文件的数组，包括保障页面正常功能的CSS和JavaScript。在本示例中，我还添加了主页和logo。当有不同的URL指向同一个资源时，你也可以将这些URL分别写到这个数组中。offlineURL将会加入到这个数组中。
- 我们也可以将一些非必要的缓存文件（installFilesDesirable）。这些文件在安装过程中将会被下载，但如果下载失败，不会触发安装失败。

```js
// configuration
const
  version = '1.0.0',
  CACHE = version + '::PWAsite',
  offlineURL = '/offline/',
  installFilesEssential = [
    '/',
    '/manifest.json',
    '/css/styles.css',
    '/js/main.js',
    '/js/offlinepage.js',
    '/images/logo/logo152.png'
  ].concat(offlineURL),
  installFilesDesirable = [
    '/favicon.ico',
    '/images/logo/logo016.png',
    '/images/hero/power-pv.jpg',
    '/images/hero/power-lo.jpg',
    '/images/hero/power-hi.jpg'
  ];
```